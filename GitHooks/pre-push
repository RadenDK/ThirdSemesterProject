#!/bin/sh

# Get the name of the branch we're pushing to
branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

# Only run tests if we're pushing to main
if [ "$branch" = "MakingATestPipeline" ]; then
  # Get a list of the files that have changed
  changed_files=$(git diff --name-only origin/$branch)

  # Check if any of the changed files are in the GameClient/GameClientApi directory
  for file in $changed_files; do
    if [[ $file == GameClient/GameClientApi/* ]]; then
      # Navigate to the test project directory
      cd ./GameClient/GameClientApiTests

      # Run the tests
      dotnet test --no-restore

      # Check the exit status of the 'dotnet test' command
      if [ $? -ne 0 ]; then
        echo "Tests failed! Aborting push."
        exit 1
      fi

      # If we got here, the tests passed. Allow the push.
      echo "Tests passed! Proceeding with push."
      exit 0
    fi
  done
fi

exit 0